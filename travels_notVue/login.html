<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<script src="./js/head.meta.js"></script>
	<title>登录</title>
	<script src="./js/head.css.js"></script>
	<script src="./js/head.js.js"></script>
	<style>	
		.icon {width: 1.5em; height: 1.5em;vertical-align: -0.15em;fill: currentColor;overflow: hidden;}
		nav{height:3rem;line-height: 3rem;back}
		nav ul li{color:#666;display: table-cell;width:10%;text-align: center;font-size:1.4rem;position:relative;color:#666;}
		li.on{color:#01af63;}
		li.on:after{content:'';position:absolute;bottom:0;left:20%;width:60%;height:2px;background-color: #01af63;}
		.nav-active{color:#01af63;border-bottom: 2px solid #01af63;}
		.login-sec,.message-sec{margin-top:1.5rem;background-color: #fff;padding:0 1rem;font-size: 1.4rem;}
		.login-sec .userid-sec .userid>div,.login-sec .userid-sec .password div,.message-sec .userid div,.message-sec .img-code .code-input,.message-sec .message-code .code-input{    padding: 0 2rem;    display: inline-block;width: 70%;border-bottom: 1px solid #eee;}
		.message-sec .message-code .code-input{width:44.5%;}
		.msg-code{display: inline-block;border: 1px solid #01af63;color: #01af63;font-size: 1.5rem;padding: 0.5rem;}
		.login-sec input,.message-sec input{border: none;height: 1.7rem;padding: 1rem 0;width: 100%;font-size: 1.4rem;background: 0 0;box-sizing: content-box;-webkit-box-sizing: content-box;color: #333;}
		.login-sec .userid-sec .userid,.login-sec .userid-sec .password{margin-bottom:1rem;}
		.login-sec .icon,.message-sec .icon{color:#01af63;}
		.do-login{margin:1rem 1rem;height:3.4rem;text-align: center;background-color: #01af63;color:#fff;font-size:1.4rem;line-height: 3.4rem;letter-spacing: 5px;}
		.other-opera-login{display: -webkit-box;-webkit-box-orient:horizontal;display: flex;}
		.other-opera-login div{flex:1;-webkit-flex:1;text-align: center;font-size: 1.4rem;height:2rem;line-height: 2rem;}
		.img-code{position: relative;}
		 .rig {position: absolute;right: 2rem;top: 0.8rem; width: 3.2rem;}
		.rig img {position: absolute;top: -0.475rem;right: 0;}
		.message-sec{display: none;}
	</style>
</head>
<body>
	<nav class="login-nav">
	<ul>
		<li class="userid-login on">账号登录</li>
		<li class="message-login">动态密码登录</li>
	</ul>
		

	</nav>
	<section class="login-sec">
		<div class="userid-sec">
			<div class="userid">
				<svg class="icon" aria-hidden="true">
                   <use xlink:href="#icon-shoujihaoma"></use>
                </svg>
				<div><input type="text" placeholder="请输入手机号">
			</div></div>
			<div class="password">
				<svg class="icon" aria-hidden="true">
                   <use xlink:href="#icon-mima"></use>
                </svg>
				<div><input type="password" placeholder="请输入密码"></div>
			</div>
		</div>
		<div class="do-login">登录</div>
		<div class="other-opera-login">
			<div class="regist">注册新用户</div>
			<div class="foget-psw">忘记密码？</div>
		</div>
	</section>
	<section class="message-sec">
		<div class="userid">
			<svg class="icon" aria-hidden="true">
                   <use xlink:href="#icon-shoujihaoma"></use>
                </svg>
			<div><input type="phone" placeholder="请输入手机号"></div>
		</div>
		<div class="img-code">
			<svg class="icon" aria-hidden="true">
                   <use xlink:href="#icon-yanzhengma"></use>
                </svg>
			<div class="code-input"><input type="text" placeholder="验证码"></div>
			<div class="rig"> <img class="code-image j_refresh" src="" alt="验证码"> </div>			
		</div>
		<div class="message-code">
			<svg class="icon" aria-hidden="true">
                   <use xlink:href="#icon-iconfontcolor11"></use>
                </svg>
			<div class="code-input"><input type="text" placeholder="动态密码"></div>
			<div class="msg-code">获取动态密码</div>			
		</div>
		<div class="do-login">登录</div>
	</section>
</body>
<script type="text/javascript" src="//at.alicdn.com/t/font_9m5y5nghp7tu766r.js"></script>
<script>
	function appStart(){
		$('.code-image').attr('src',config.SERVER_URL+'/validate.php');
		Endload();
		$('.login-nav li').on('click',function(){
			$(this).addClass('on').siblings().removeClass('on');
			if($(this).hasClass('userid-login')){
				
				$('.login-sec').css('display','block');
				$('.message-sec').css('display','none');
			}else{
				$('.login-sec').css('display','none');
				$('.message-sec').css('display','block');
			}
		});
		$('.login-sec .do-login').on('click',function(){
			var param={};	
			param.phone=$('.login-sec .userid input').val();
			param.passwd=$('.login-sec .password input').val();
			var checkresult=checkInput(0,param);
			if(checkresult ==true){
				ajaxJson(API.LOGIN_LOGIN,param,function(data){
		            if(data.status==1){
		                console.log(data);
		                $.cookie('travelsUserId',param.phone, { expires: 1, path: '/' });
		                PageGoto('index');        
		            }else{	
		            	tipsLayer(data.info);
		            }
		        });
	        }else{
	        	tipsLayer(checkresult);
	        };
		});
		$('.message-sec .do-login').on('click',function(){
			var param={};	
			param.phone=$('.message-sec .userid input').val();
			param.valid=$('.img-code input').val();
			param.verify=$('.message-code input').val();
			var checkresult=checkInput(1,param);
			if(checkresult ==true){
				ajaxJson(API.LOGIN_LOGIN,param,function(data){
		            if(data.status==1){
		                console.log(data);
		                $.cookie('travelsUserId',param.phone, { expires: 1, path: '/' });
		                PageGoto('index');        
		            }else{	
		            	tipsLayer(data.info);
		            }
		        });
	        }else{
	        	tipsLayer(checkresult);
	        };
		});
		$('.regist').on('click',function(){
			PageGoto('regist');
		});
		$('.foget-psw').on('click',function(){
			PageGoto('forgetPSW');
		});
		$('.msg-code').on('click',function(){
			var _this=$(this);
			var param={};
			param.phone=$('.message-sec .userid input').val();
			param.valid=$('.message-sec .img-code input').val();
			var checkresult=checkInput(2,param);
			if(checkresult ==true){
				ajaxJson(API.LOGIN_PHONEVAL,param,function(data){
		            if(data.status==1){
		               _this.html('已发送');        
		            }else{	
		            	tipsLayer(data.info);
		            }
		        });
			}
		})
	}
	function checkInput( type,params){
	    if(typeof params != "object") return;
	    var result=true;
	    var phoneFilter=/^1\d{10}/;    
	    if(!phoneFilter.test(params.phone)) return "请输入正确格式的手机号"; 
	    if(type==0){//密码登录验证
	    	if(params.passwd!=undefined && (params.passwd.length<4 || params.passwd.length>16)) return "密码位数不合适,请重新输入";
	    }else if(type==1){//验证码登录
	    	if(params.valid==undefined || params.valid=="") return "请输入验证码！";
        	if(params.verify==undefined || params.verify=="") return "请输入手机验证码！";
	    }else if(type==2){//获取手机验证码
	    	if(params.valid==undefined || params.valid=="") return "请输入验证码！";
	    }
	    return true; 
	   // return true;
	}
</script>
</html>